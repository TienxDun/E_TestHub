@{
    ViewData["Title"] = "Làm bài thi - Sinh Viên";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@section Styles {
    <link href="~/css/shared/dashboard.css" rel="stylesheet">
    <link href="~/css/student/take-exam.css" rel="stylesheet">
}

<div class="exam-container">
    <!-- Left Sidebar - Question Navigation -->
    <div class="question-nav-sidebar">
        <div class="nav-header">
            <div class="nav-title">Danh sách câu hỏi</div>
            <div class="nav-subtitle">Đã hoàn thành: <span id="completedCount">1</span>/12 câu hỏi</div>
        </div>
        
        <div class="question-grid">
            <div class="question-number current" onclick="goToQuestion(1)">1</div>
            <div class="question-number" onclick="goToQuestion(2)">2</div>
            <div class="question-number" onclick="goToQuestion(3)">3</div>
            <div class="question-number" onclick="goToQuestion(4)">4</div>
            <div class="question-number" onclick="goToQuestion(5)">5</div>
            <div class="question-number" onclick="goToQuestion(6)">6</div>
            <div class="question-number" onclick="goToQuestion(7)">7</div>
            <div class="question-number" onclick="goToQuestion(8)">8</div>
            <div class="question-number" onclick="goToQuestion(9)">9</div>
            <div class="question-number" onclick="goToQuestion(10)">10</div>
            <div class="question-number" onclick="goToQuestion(11)">11</div>
            <div class="question-number" onclick="goToQuestion(12)">12</div>
        </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="exam-main-content">
        <!-- Exam Header -->
        <div class="exam-header">
            <div class="exam-info">
                <a href="@Url.Action("ExamInfo", "Student", new { examId = ViewBag.ExamId })" class="back-btn">
                    <i class="fas fa-arrow-left"></i>
                    Quay lại
                </a>
                <h1 class="exam-title">Thi sinh: Võ Nguyễn Thanh Hiếu</h1>
            </div>
            
            <div class="exam-controls">
                <div class="timer">
                    <i class="fas fa-clock"></i>
                    <span id="timeRemaining">12:06:02</span>
                </div>
                <button class="submit-btn" onclick="submitExam()">
                    <i class="fas fa-paper-plane"></i>
                    Nộp bài
                </button>
            </div>
        </div>
        
        <!-- Question Content -->
        <div class="question-content">
            <div class="question-header">
                <h2 class="question-title">Câu <span id="currentQuestionNumber">1</span></h2>
            </div>
            
            <div id="questionContainer">
                <!-- Question 1 -->
                <div class="question" id="question1" style="display: block;">
                    <div class="question-text">
                        How many lamps ................?.................... one
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question1" value="A">
                                <span class="answer-text">there are / There are</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question1" value="B">
                                <span class="answer-text">are there / Is there</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question1" value="C">
                                <span class="answer-text">there are / There is</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question1" value="D" checked>
                                <span class="answer-text">are there/ There is</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 2 -->
                <div class="question" id="question2" style="display: none;">
                    <div class="question-text">
                        A hairdresser .........my hair.
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question2" value="A">
                                <span class="answer-text">cuts</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question2" value="B">
                                <span class="answer-text">Do</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question2" value="C">
                                <span class="answer-text">make</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question2" value="D">
                                <span class="answer-text">cut</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 3 -->
                <div class="question" id="question3" style="display: none;">
                    <div class="question-text">
                        Jane ............ from Australia. She ............ two languages: English and French
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question3" value="A">
                                <span class="answer-text">Comes / speaks</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question3" value="B">
                                <span class="answer-text">Comes / speak</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question3" value="C">
                                <span class="answer-text">Come / speak</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question3" value="D">
                                <span class="answer-text">Come / speaks</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 4 -->
                <div class="question" id="question4" style="display: none;">
                    <div class="question-text">
                        What ............ you ............ for breakfast?
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question4" value="A">
                                <span class="answer-text">do / have</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question4" value="B">
                                <span class="answer-text">does / have</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question4" value="C">
                                <span class="answer-text">do / has</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question4" value="D">
                                <span class="answer-text">does / has</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 5 -->
                <div class="question" id="question5" style="display: none;">
                    <div class="question-text">
                        My sister ............ television every evening.
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question5" value="A">
                                <span class="answer-text">watch</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question5" value="B">
                                <span class="answer-text">watches</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question5" value="C">
                                <span class="answer-text">watching</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question5" value="D">
                                <span class="answer-text">watched</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 6 -->
                <div class="question" id="question6" style="display: none;">
                    <div class="question-text">
                        ............ students are there in your class?
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question6" value="A">
                                <span class="answer-text">How much</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question6" value="B">
                                <span class="answer-text">How many</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question6" value="C">
                                <span class="answer-text">How old</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question6" value="D">
                                <span class="answer-text">How long</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 7 -->
                <div class="question" id="question7" style="display: none;">
                    <div class="question-text">
                        I ............ coffee but I ............ tea.
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question7" value="A">
                                <span class="answer-text">don't like / like</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question7" value="B">
                                <span class="answer-text">doesn't like / likes</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question7" value="C">
                                <span class="answer-text">don't like / likes</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question7" value="D">
                                <span class="answer-text">doesn't like / like</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 8 -->
                <div class="question" id="question8" style="display: none;">
                    <div class="question-text">
                        Where ............ your parents ............?
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question8" value="A">
                                <span class="answer-text">do / live</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question8" value="B">
                                <span class="answer-text">does / live</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question8" value="C">
                                <span class="answer-text">do / lives</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question8" value="D">
                                <span class="answer-text">does / lives</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 9 -->
                <div class="question" id="question9" style="display: none;">
                    <div class="question-text">
                        She ............ to work by bus every day.
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question9" value="A">
                                <span class="answer-text">go</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question9" value="B">
                                <span class="answer-text">goes</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question9" value="C">
                                <span class="answer-text">going</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question9" value="D">
                                <span class="answer-text">went</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 10 -->
                <div class="question" id="question10" style="display: none;">
                    <div class="question-text">
                        ............ you speak English?
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question10" value="A">
                                <span class="answer-text">Do</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question10" value="B">
                                <span class="answer-text">Does</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question10" value="C">
                                <span class="answer-text">Are</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question10" value="D">
                                <span class="answer-text">Is</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 11 -->
                <div class="question" id="question11" style="display: none;">
                    <div class="question-text">
                        My brother ............ a doctor. He ............ in a hospital.
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question11" value="A">
                                <span class="answer-text">is / work</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question11" value="B">
                                <span class="answer-text">is / works</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question11" value="C">
                                <span class="answer-text">are / work</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question11" value="D">
                                <span class="answer-text">are / works</span>
                            </label>
                        </li>
                    </ul>
                </div>
                
                <!-- Question 12 -->
                <div class="question" id="question12" style="display: none;">
                    <div class="question-text">
                        ............ often ............ you go to the cinema?
                    </div>
                    
                    <ul class="answer-options">
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question12" value="A">
                                <span class="answer-text">How / do</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question12" value="B">
                                <span class="answer-text">How / does</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question12" value="C">
                                <span class="answer-text">How often / do</span>
                            </label>
                        </li>
                        <li class="answer-option">
                            <label>
                                <input type="radio" name="question12" value="D">
                                <span class="answer-text">How often / does</span>
                            </label>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- Navigation Footer -->
        <div class="question-navigation">
            <button class="nav-btn" id="prevBtn" onclick="previousQuestion()" disabled>
                <i class="fas fa-chevron-left"></i>
                Câu trước
            </button>
            
            <span class="question-counter">
                Câu <span id="currentQuestion">1</span> / 12
            </span>
            
            <button class="nav-btn primary" id="nextBtn" onclick="nextQuestion()">
                Câu tiếp
                <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        let currentQuestionIndex = 1;
        const totalQuestions = 12;
        let answers = {};
        
        // Timer functionality
        let timeLeft = 12 * 3600 + 6 * 60 + 2; // 12:06:02 in seconds
        
        function updateTimer() {
            const hours = Math.floor(timeLeft / 3600);
            const minutes = Math.floor((timeLeft % 3600) / 60);
            const seconds = timeLeft % 60;
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('timeRemaining').textContent = timeString;
            
            if (timeLeft <= 0) {
                submitExam();
                return;
            }
            
            timeLeft--;
        }
        
        setInterval(updateTimer, 1000);
        
        function goToQuestion(questionNumber) {
            // Hide current question
            document.getElementById(`question${currentQuestionIndex}`).style.display = 'none';
            
            // Update current question index
            currentQuestionIndex = questionNumber;
            
            // Show new question
            document.getElementById(`question${currentQuestionIndex}`).style.display = 'block';
            
            // Update UI
            updateQuestionUI();
        }
        
        function nextQuestion() {
            if (currentQuestionIndex < totalQuestions) {
                goToQuestion(currentQuestionIndex + 1);
            }
        }
        
        function previousQuestion() {
            if (currentQuestionIndex > 1) {
                goToQuestion(currentQuestionIndex - 1);
            }
        }
        
        function updateQuestionUI() {
            // Update question number displays
            document.getElementById('currentQuestionNumber').textContent = currentQuestionIndex;
            document.getElementById('currentQuestion').textContent = currentQuestionIndex;
            
            // Update navigation buttons
            document.getElementById('prevBtn').disabled = currentQuestionIndex === 1;
            document.getElementById('nextBtn').disabled = currentQuestionIndex === totalQuestions;
            
            // Update question number buttons
            document.querySelectorAll('.question-number').forEach((btn, index) => {
                btn.classList.remove('current');
                if (index + 1 === currentQuestionIndex) {
                    btn.classList.add('current');
                }
            });
            
            // Update completed count
            updateCompletedCount();
        }
        
        function updateCompletedCount() {
            let completed = 0;
            for (let i = 1; i <= totalQuestions; i++) {
                const questionInputs = document.querySelectorAll(`input[name="question${i}"]`);
                const isAnswered = Array.from(questionInputs).some(input => input.checked);
                
                if (isAnswered) {
                    completed++;
                    document.querySelector(`.question-number:nth-child(${i})`).classList.add('answered');
                } else {
                    document.querySelector(`.question-number:nth-child(${i})`).classList.remove('answered');
                }
            }
            
            document.getElementById('completedCount').textContent = completed;
        }
        
        function submitExam() {
            if (confirm('Bạn có chắc chắn muốn nộp bài? Bạn sẽ không thể chỉnh sửa sau khi nộp.')) {
                // Collect all answers
                const examData = {};
                for (let i = 1; i <= totalQuestions; i++) {
                    const selectedAnswer = document.querySelector(`input[name="question${i}"]:checked`);
                    if (selectedAnswer) {
                        examData[`question${i}`] = selectedAnswer.value;
                    }
                }
                
                // Submit to server (you can implement the actual submission logic here)
                console.log('Exam submitted:', examData);
                alert('Bài thi đã được nộp thành công!');
                
                // Redirect to results or dashboard
                window.location.href = '@Url.Action("ViewResults", "Student")';
            }
        }
        
        // Add event listeners for answer selection
        document.addEventListener('change', function(e) {
            if (e.target.type === 'radio') {
                updateCompletedCount();
            }
        });
        
        // Keyboard navigation
        document.addEventListener('keydown', function(e) {
            if (e.key === 'ArrowLeft' && currentQuestionIndex > 1) {
                previousQuestion();
            } else if (e.key === 'ArrowRight' && currentQuestionIndex < totalQuestions) {
                nextQuestion();
            }
        });
        
        // Initialize
        updateQuestionUI();
        updateCompletedCount();
        
        // Prevent accidental page refresh
        window.addEventListener('beforeunload', function(e) {
            e.preventDefault();
            e.returnValue = 'Bạn có chắc chắn muốn rời khỏi trang? Bài thi của bạn sẽ không được lưu.';
        });
    </script>
}