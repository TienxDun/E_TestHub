@{
    ViewData["Title"] = "Quản lý đề thi";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@section Styles {
    <link href="~/css/shared/dashboard.css" rel="stylesheet">
    <link href="~/css/teacher/exam-management.css" rel="stylesheet">
}

<!-- Welcome Section -->
<div class="dashboard-welcome-section">
    <h1 class="dashboard-welcome-title" style="font-weight: 700; color: #1a73e8;">Quản lý đề thi</h1>
    <p class="dashboard-welcome-subtitle">Tạo, chỉnh sửa và quản lý các đề thi của bạn</p>
</div>

<!-- Action Cards -->
<div class="dashboard-action-cards">
    <a href="@Url.Action("CreateExam", "Teacher")" class="dashboard-action-card">
        <div class="dashboard-action-icon">
            <i class="fas fa-plus-circle"></i>
        </div>
        <h3 class="dashboard-action-title">Tạo đề thi mới</h3>
        <p class="dashboard-action-subtitle">Tạo đề thi trắc nghiệm mới</p>
    </a>

    <a href="@Url.Action("QuestionBank", "Teacher")" class="dashboard-action-card">
        <div class="dashboard-action-icon">
            <i class="fas fa-database"></i>
        </div>
        <h3 class="dashboard-action-title">Ngân hàng câu hỏi</h3>
        <p class="dashboard-action-subtitle">Quản lý kho câu hỏi</p>
    </a>

    <a href="#" class="dashboard-action-card" onclick="openSearchModal(); return false;">
        <div class="dashboard-action-icon">
            <i class="fas fa-search"></i>
        </div>
        <h3 class="dashboard-action-title">Tìm kiếm đề thi</h3>
        <p class="dashboard-action-subtitle">Tìm kiếm nhanh theo tên</p>
    </a>
</div>

<!-- Content Sections -->
<div class="dashboard-content-sections">
    <!-- Recent Exams Section -->
    <div class="dashboard-section">
        <div class="dashboard-section-header">
            <h3 class="dashboard-section-title">Đề thi gần đây</h3>
            <a href="#all-exams" class="dashboard-view-more-btn">
                <i class="fas fa-chevron-down"></i>
                Xem tất cả
            </a>
        </div>

        <ul class="dashboard-item-list">
            <!-- Demo Data - Replace with actual data from ViewBag -->
            <li class="dashboard-item">
                <div class="dashboard-item-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="dashboard-item-content">
                    <h4 class="dashboard-item-title">Kiểm tra giữa kỳ - Xác suất thống kê</h4>
                    <p class="dashboard-item-subtitle">45 câu hỏi • 90 phút</p>
                    <p class="dashboard-item-subtitle">Tạo ngày: 15/09/2025</p>
                </div>
                <div class="dashboard-item-actions">
                    <a href="@Url.Action("ExamDetails", "Teacher", new { examId = 1 })" class="dashboard-item-action-btn" title="Xem chi tiết">
                        <i class="fas fa-eye"></i>
                    </a>
                    <a href="#" class="dashboard-item-action-btn" title="Chỉnh sửa" onclick="alert('Tính năng đang phát triển'); return false;">
                        <i class="fas fa-edit"></i>
                    </a>
                </div>
            </li>

            <li class="dashboard-item">
                <div class="dashboard-item-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="dashboard-item-content">
                    <h4 class="dashboard-item-title">Bài tập tuần 5 - Đại số tuyến tính</h4>
                    <p class="dashboard-item-subtitle">30 câu hỏi • 60 phút</p>
                    <p class="dashboard-item-subtitle">Tạo ngày: 10/09/2025</p>
                </div>
                <div class="dashboard-item-actions">
                    <a href="@Url.Action("ExamDetails", "Teacher", new { examId = 2 })" class="dashboard-item-action-btn" title="Xem chi tiết">
                        <i class="fas fa-eye"></i>
                    </a>
                    <a href="#" class="dashboard-item-action-btn" title="Chỉnh sửa" onclick="alert('Tính năng đang phát triển'); return false;">
                        <i class="fas fa-edit"></i>
                    </a>
                </div>
            </li>

            <li class="dashboard-item">
                <div class="dashboard-item-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="dashboard-item-content">
                    <h4 class="dashboard-item-title">Thi cuối kỳ - Giải tích 1</h4>
                    <p class="dashboard-item-subtitle">50 câu hỏi • 120 phút</p>
                    <p class="dashboard-item-subtitle">Tạo ngày: 05/09/2025</p>
                </div>
                <div class="dashboard-item-actions">
                    <a href="@Url.Action("ExamDetails", "Teacher", new { examId = 3 })" class="dashboard-item-action-btn" title="Xem chi tiết">
                        <i class="fas fa-eye"></i>
                    </a>
                    <a href="#" class="dashboard-item-action-btn" title="Chỉnh sửa" onclick="alert('Tính năng đang phát triển'); return false;">
                        <i class="fas fa-edit"></i>
                    </a>
                </div>
            </li>
        </ul>
    </div>

    <!-- Exam Statistics Section -->
    <div class="dashboard-section">
        <div class="dashboard-section-header">
            <h3 class="dashboard-section-title">Thống kê</h3>
        </div>

        <div class="exam-stats-grid">
            <div class="exam-stat-card">
                <div class="exam-stat-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
                <div class="exam-stat-content">
                    <h4 class="exam-stat-number">24</h4>
                    <p class="exam-stat-label">Tổng đề thi</p>
                </div>
            </div>

            <div class="exam-stat-card">
                <div class="exam-stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="exam-stat-content">
                    <h4 class="exam-stat-number">8</h4>
                    <p class="exam-stat-label">Đang diễn ra</p>
                </div>
            </div>

            <div class="exam-stat-card">
                <div class="exam-stat-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <div class="exam-stat-content">
                    <h4 class="exam-stat-number">156</h4>
                    <p class="exam-stat-label">Bài đã nộp</p>
                </div>
            </div>

            <div class="exam-stat-card">
                <div class="exam-stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="exam-stat-content">
                    <h4 class="exam-stat-number">396</h4>
                    <p class="exam-stat-label">Sinh viên</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- All Exams Section (Anchor for scroll) -->
<div id="all-exams" class="dashboard-section" style="margin-top: 50px;">
    <div class="dashboard-section-header">
        <h3 class="dashboard-section-title">Tất cả đề thi</h3>
        <div class="exam-table-search">
            <input type="text" id="examSearch" placeholder="Tìm kiếm đề thi..." />
            <i class="fas fa-search"></i>
        </div>
    </div>

    <div class="exam-table-container">
        <table class="exam-table">
            <thead>
                <tr>
                    <th>Tên đề thi</th>
                    <th>Số câu hỏi</th>
                    <th>Thời gian</th>
                    <th>Lớp</th>
                    <th>Trạng thái</th>
                    <th>Thao tác</th>
                </tr>
            </thead>
            <tbody id="examTableBody">
                <!-- Demo Data - Replace with actual data -->
                <tr>
                    <td>
                        <div class="exam-table-name-cell">
                            <i class="fas fa-file-alt"></i>
                            <span>Kiểm tra giữa kỳ - Xác suất thống kê</span>
                        </div>
                    </td>
                    <td>45</td>
                    <td>90 phút</td>
                    <td>PM233H</td>
                    <td><span class="exam-status-badge status-active">Đang diễn ra</span></td>
                    <td>
                        <div class="exam-table-actions">
                            <a href="@Url.Action("ExamDetails", "Teacher", new { examId = 1 })" title="Xem chi tiết">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="#" title="Chỉnh sửa" onclick="alert('Tính năng đang phát triển'); return false;">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="#" title="Xóa" onclick="if(confirm('Bạn có chắc chắn muốn xóa đề thi này?')) alert('Tính năng đang phát triển'); return false;">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="exam-table-name-cell">
                            <i class="fas fa-file-alt"></i>
                            <span>Bài tập tuần 5 - Đại số tuyến tính</span>
                        </div>
                    </td>
                    <td>30</td>
                    <td>60 phút</td>
                    <td>TM231H</td>
                    <td><span class="exam-status-badge status-upcoming">Sắp diễn ra</span></td>
                    <td>
                        <div class="exam-table-actions">
                            <a href="@Url.Action("ExamDetails", "Teacher", new { examId = 2 })" title="Xem chi tiết">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="#" title="Chỉnh sửa" onclick="alert('Tính năng đang phát triển'); return false;">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a href="#" title="Xóa" onclick="if(confirm('Bạn có chắc chắn muốn xóa đề thi này?')) alert('Tính năng đang phát triển'); return false;">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </div>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div class="exam-table-name-cell">
                            <i class="fas fa-file-alt"></i>
                            <span>Thi cuối kỳ - Giải tích 1</span>
                        </div>
                    </td>
                    <td>50</td>
                    <td>120 phút</td>
                    <td>PM233H, TM231H</td>
                    <td><span class="exam-status-badge status-completed">Đã kết thúc</span></td>
                    <td>
                        <div class="exam-table-actions">
                            <a href="@Url.Action("ExamDetails", "Teacher", new { examId = 3 })" title="Xem chi tiết">
                                <i class="fas fa-eye"></i>
                            </a>
                            <a href="@Url.Action("ViewResults", "Teacher", new { examId = 3 })" title="Xem kết quả">
                                <i class="fas fa-chart-bar"></i>
                            </a>
                            <a href="#" title="Xóa" onclick="if(confirm('Bạn có chắc chắn muốn xóa đề thi này?')) alert('Tính năng đang phát triển'); return false;">
                                <i class="fas fa-trash-alt"></i>
                            </a>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Search Modal -->
<div id="searchModal" class="search-modal" style="display: none;">
    <div class="search-modal-content">
        <div class="search-modal-header">
            <h3>Tìm kiếm đề thi</h3>
            <button onclick="closeSearchModal()" class="search-modal-close">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="search-modal-body">
            <input type="text" id="modalSearchInput" placeholder="Nhập tên đề thi..." class="search-modal-input" />
            <div id="searchResults" class="search-results">
                <p class="search-placeholder">Nhập để tìm kiếm...</p>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Table search functionality
        document.getElementById('examSearch').addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const tableRows = document.querySelectorAll('#examTableBody tr');
            
            tableRows.forEach(row => {
                const examName = row.querySelector('.exam-table-name-cell span')?.textContent.toLowerCase() || '';
                if (examName.includes(searchTerm)) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        });

        // Search modal functions
        function openSearchModal() {
            document.getElementById('searchModal').style.display = 'flex';
            document.getElementById('modalSearchInput').focus();
        }

        function closeSearchModal() {
            document.getElementById('searchModal').style.display = 'none';
            document.getElementById('modalSearchInput').value = '';
            document.getElementById('searchResults').innerHTML = '<p class="search-placeholder">Nhập để tìm kiếm...</p>';
        }

        // Modal search functionality (demo)
        document.getElementById('modalSearchInput')?.addEventListener('input', function(e) {
            const searchTerm = e.target.value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (searchTerm.length === 0) {
                resultsDiv.innerHTML = '<p class="search-placeholder">Nhập để tìm kiếm...</p>';
                return;
            }

            // Demo search results
            const demoExams = [
                { id: 1, name: 'Kiểm tra giữa kỳ - Xác suất thống kê', questions: 45, time: 90 },
                { id: 2, name: 'Bài tập tuần 5 - Đại số tuyến tính', questions: 30, time: 60 },
                { id: 3, name: 'Thi cuối kỳ - Giải tích 1', questions: 50, time: 120 }
            ];

            const filtered = demoExams.filter(exam => 
                exam.name.toLowerCase().includes(searchTerm)
            );

            if (filtered.length === 0) {
                resultsDiv.innerHTML = '<p class="search-placeholder">Không tìm thấy kết quả</p>';
            } else {
                resultsDiv.innerHTML = filtered.map(exam => `
                    <a href="${'@Url.Action("ExamDetails", "Teacher")'}&examId=${exam.id}" class="search-result-item">
                        <i class="fas fa-file-alt"></i>
                        <div>
                            <h4>${exam.name}</h4>
                            <p>${exam.questions} câu hỏi • ${exam.time} phút</p>
                        </div>
                    </a>
                `).join('');
            }
        });

        // Close modal on outside click
        document.getElementById('searchModal')?.addEventListener('click', function(e) {
            if (e.target === this) {
                closeSearchModal();
            }
        });

        // Smooth scroll to all exams
        document.querySelector('.dashboard-view-more-btn')?.addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('all-exams').scrollIntoView({ behavior: 'smooth' });
        });
    </script>
}
