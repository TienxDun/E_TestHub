@{
    ViewData["Title"] = "Quản Lý Trường Học - Quản Trị Viên";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@section Styles {
    <link href="~/css/admin/school-management.css" rel="stylesheet">
}

<div class="school-management-container">
    <div class="school-management-header">
        <h1 class="school-management-title">Quản Lý Trường Học</h1>
        <p class="school-management-subtitle">Quản lý thông tin trường học, lớp học và khóa học</p>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons">
        <a href="@Url.Action("Create", "Class")" class="btn btn-primary">
            <i class="fas fa-plus"></i> Thêm Lớp Học
        </a>
        <button class="btn btn-secondary" onclick="location.reload()">
            <i class="fas fa-sync"></i> Làm Mới
        </button>
    </div>

    <!-- Classes Section -->
    <div class="management-section">
        <div class="section-header">
            <h2 class="section-title">Danh Sách Lớp Học</h2>
            <div class="section-actions">
                <input type="text" id="classSearch" class="search-input" placeholder="Tìm kiếm lớp học..." />
            </div>
        </div>

        <div class="table-responsive">
            <table class="management-table" id="classesTable">
                <thead>
                    <tr>
                        <th>Mã Lớp</th>
                        <th>Tên Lớp</th>
                        <th>Khóa Học</th>
                        <th>Sĩ Số</th>
                        <th>Giáo Viên Chủ Nhiệm</th>
                        <th>Trạng Thái</th>
                        <th>Thao Tác</th>
                    </tr>
                </thead>
                <tbody>
                    @if (ViewBag.Classes != null && ViewBag.Classes.Count > 0)
                    {
                        foreach (var cls in ViewBag.Classes)
                        {
                            <tr>
                                <td>@cls.ClassCode</td>
                                <td>@cls.Name</td>
                                <td>@cls.AcademicYear</td>
                                <td>@cls.Students.Count</td>
                                <td>@(cls.Teacher?.FullName ?? "Chưa phân công")</td>
                                <td>
                                    <span class="status-badge status-active">Hoạt Động</span>
                                </td>
                                <td>
                                    <a href="@Url.Action("Edit", "Class", new { id = cls.Id })" class="btn-action btn-edit" title="Chỉnh sửa">
                                        <i class="fas fa-edit"></i>
                                    </a>
                                    <a href="@Url.Action("Details", "Class", new { id = cls.Id })" class="btn-action btn-view" title="Xem chi tiết">
                                        <i class="fas fa-eye"></i>
                                    </a>
                                    <button class="btn-action btn-delete" onclick="deleteClass('@cls.Id', '@cls.Name')" title="Xóa">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        }
                    }
                    else
                    {
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                <i class="fas fa-inbox fa-2x mb-2 d-block"></i>
                                <p class="mb-0">Chưa có lớp học nào. Nhấn "Thêm Lớp Học" để tạo mới.</p>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>

    <!-- Courses Section -->
    <div class="management-section">
        <div class="section-header">
            <h2 class="section-title">Danh Sách Khóa Học</h2>
            <div class="section-actions">
                <input type="text" id="courseSearch" class="search-input" placeholder="Tìm kiếm khóa học..." />
            </div>
        </div>

        <div class="table-responsive">
            <table class="management-table" id="coursesTable">
                <thead>
                    <tr>
                        <th>Mã Khóa Học</th>
                        <th>Tên Khóa Học</th>
                        <th>Năm Bắt Đầu</th>
                        <th>Năm Kết Thúc</th>
                        <th>Số Lớp</th>
                        <th>Trạng Thái</th>
                        <th>Thao Tác</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td colspan="7" class="text-center text-muted py-5">
                            <i class="fas fa-graduation-cap fa-3x mb-3 d-block"></i>
                            <p class="mb-0">Quản lý khóa học sẽ được triển khai trong phiên bản tiếp theo</p>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            // Search functionality
            $('#classSearch').on('keyup', function () {
                var value = $(this).val().toLowerCase();
                $('#classesTable tbody tr').filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });

            $('#courseSearch').on('keyup', function () {
                var value = $(this).val().toLowerCase();
                $('#coursesTable tbody tr').filter(function () {
                    $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1);
                });
            });

            // Note: Class management now uses ClassController actions
            // Edit and delete functionality implemented via links and deleteClass() function
        });

        // Delete class function
        function deleteClass(classId, className) {
            Swal.fire({
                title: 'Xác nhận xóa',
                html: `Bạn có chắc muốn xóa lớp <strong>${className}</strong>?<br><small class="text-muted">Hành động này không thể hoàn tác!</small>`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#d33',
                cancelButtonColor: '#6c757d',
                confirmButtonText: 'Xóa',
                cancelButtonText: 'Hủy'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Redirect to delete action
                    window.location.href = '@Url.Action("Delete", "Class")?id=' + classId;
                }
            });
        }
    </script>
}