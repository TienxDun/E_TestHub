@{
    ViewData["Title"] = "Nhật Ký Kiểm Tra - Quản Trị Viên";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@section Styles {
    <link href="~/css/admin/audit-logs.css" rel="stylesheet">
}

<div class="audit-logs-container">
    <div class="audit-logs-header">
        <h1 class="audit-logs-title">Nhật Ký Kiểm Tra</h1>
        <p class="audit-logs-subtitle">Theo dõi và giám sát các hoạt động trong hệ thống</p>
    </div>

    <!-- Filters Section -->
    <div class="filters-section">
        <div class="filter-group">
            <label for="dateFrom" class="filter-label">Từ Ngày</label>
            <input type="date" id="dateFrom" class="filter-input" value="@DateTime.Now.AddDays(-7).ToString("yyyy-MM-dd")" />
        </div>

        <div class="filter-group">
            <label for="dateTo" class="filter-label">Đến Ngày</label>
            <input type="date" id="dateTo" class="filter-input" value="@DateTime.Now.ToString("yyyy-MM-dd")" />
        </div>

        <div class="filter-group">
            <label for="userFilter" class="filter-label">Người Dùng</label>
            <select id="userFilter" class="filter-select">
                <option value="">Tất Cả</option>
                <option value="admin">Quản Trị Viên</option>
                <option value="teacher">Giáo Viên</option>
                <option value="student">Sinh Viên</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="actionFilter" class="filter-label">Hành Động</label>
            <select id="actionFilter" class="filter-select">
                <option value="">Tất Cả</option>
                <option value="login">Đăng Nhập</option>
                <option value="logout">Đăng Xuất</option>
                <option value="create">Tạo</option>
                <option value="update">Cập Nhật</option>
                <option value="delete">Xóa</option>
                <option value="view">Xem</option>
            </select>
        </div>

        <div class="filter-actions">
            <button id="applyFilters" class="btn btn-primary">
                <i class="fas fa-filter"></i> Áp Dụng
            </button>
            <button id="clearFilters" class="btn btn-secondary">
                <i class="fas fa-times"></i> Xóa Bộ Lọc
            </button>
            <button id="exportLogs" class="btn btn-secondary">
                <i class="fas fa-download"></i> Xuất Log
            </button>
        </div>
    </div>

    <!-- Logs Table -->
    <div class="logs-table-container">
        <div class="table-header">
            <h3 class="table-title">Danh Sách Nhật Ký</h3>
            <div class="table-info">
                <span id="totalLogs">Hiển thị 0 / 0 nhật ký</span>
            </div>
        </div>

        <div class="table-responsive">
            <table class="logs-table" id="logsTable">
                <thead>
                    <tr>
                        <th>Thời Gian</th>
                        <th>Người Dùng</th>
                        <th>Vai Trò</th>
                        <th>Hành Động</th>
                        <th>Mô Tả</th>
                        <th>IP Address</th>
                        <th>Trạng Thái</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Sample data - will be populated from database -->
                    <tr>
                        <td>@DateTime.Now.ToString("dd/MM/yyyy HH:mm:ss")</td>
                        <td>admin@etest.com</td>
                        <td><span class="role-badge role-admin">Quản Trị Viên</span></td>
                        <td><span class="action-badge action-login">Đăng Nhập</span></td>
                        <td>Đăng nhập thành công vào hệ thống</td>
                        <td>192.168.1.100</td>
                        <td><span class="status-badge status-success">Thành Công</span></td>
                    </tr>
                    <tr>
                        <td>@DateTime.Now.AddMinutes(-5).ToString("dd/MM/yyyy HH:mm:ss")</td>
                        <td>teacher@etest.com</td>
                        <td><span class="role-badge role-teacher">Giáo Viên</span></td>
                        <td><span class="action-badge action-create">Tạo</span></td>
                        <td>Tạo kỳ thi "Toán Học Cơ Bản"</td>
                        <td>192.168.1.101</td>
                        <td><span class="status-badge status-success">Thành Công</span></td>
                    </tr>
                    <tr>
                        <td>@DateTime.Now.AddMinutes(-10).ToString("dd/MM/yyyy HH:mm:ss")</td>
                        <td>student@etest.com</td>
                        <td><span class="role-badge role-student">Sinh Viên</span></td>
                        <td><span class="action-badge action-view">Xem</span></td>
                        <td>Xem kết quả kỳ thi "Toán Học Cơ Bản"</td>
                        <td>192.168.1.102</td>
                        <td><span class="status-badge status-success">Thành Công</span></td>
                    </tr>
                    <tr>
                        <td>@DateTime.Now.AddMinutes(-15).ToString("dd/MM/yyyy HH:mm:ss")</td>
                        <td>unknown@etest.com</td>
                        <td><span class="role-badge role-unknown">Không Xác Định</span></td>
                        <td><span class="action-badge action-login">Đăng Nhập</span></td>
                        <td>Thử đăng nhập với mật khẩu sai</td>
                        <td>192.168.1.103</td>
                        <td><span class="status-badge status-failed">Thất Bại</span></td>
                    </tr>
                    <tr>
                        <td>@DateTime.Now.AddMinutes(-20).ToString("dd/MM/yyyy HH:mm:ss")</td>
                        <td>admin@etest.com</td>
                        <td><span class="role-badge role-admin">Quản Trị Viên</span></td>
                        <td><span class="action-badge action-update">Cập Nhật</span></td>
                        <td>Cập nhật cài đặt hệ thống</td>
                        <td>192.168.1.100</td>
                        <td><span class="status-badge status-success">Thành Công</span></td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination-container">
            <div class="pagination-info">
                <span id="paginationInfo">Trang 1 / 1</span>
            </div>
            <div class="pagination-controls">
                <button id="prevPage" class="btn btn-outline" disabled>
                    <i class="fas fa-chevron-left"></i> Trước
                </button>
                <div class="page-numbers">
                    <button class="page-number active">1</button>
                </div>
                <button id="nextPage" class="btn btn-outline" disabled>
                    Sau <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>
    </div>

    <!-- Log Details Modal -->
    <div class="modal fade" id="logDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Chi Tiết Nhật Ký</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="log-details">
                        <div class="detail-row">
                            <span class="detail-label">Thời Gian:</span>
                            <span class="detail-value" id="detailTimestamp"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Người Dùng:</span>
                            <span class="detail-value" id="detailUser"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Vai Trò:</span>
                            <span class="detail-value" id="detailRole"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Hành Động:</span>
                            <span class="detail-value" id="detailAction"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Mô Tả:</span>
                            <span class="detail-value" id="detailDescription"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">IP Address:</span>
                            <span class="detail-value" id="detailIP"></span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">User Agent:</span>
                            <span class="detail-value" id="detailUserAgent">Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36</span>
                        </div>
                        <div class="detail-row">
                            <span class="detail-label">Trạng Thái:</span>
                            <span class="detail-value" id="detailStatus"></span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            // Apply filters
            $('#applyFilters').click(function () {
                // In a real implementation, this would filter the logs
                alert('Đang áp dụng bộ lọc... (Tính năng sẽ được triển khai sau)');
            });

            // Clear filters
            $('#clearFilters').click(function () {
                $('#dateFrom').val('@DateTime.Now.AddDays(-7).ToString("yyyy-MM-dd")');
                $('#dateTo').val('@DateTime.Now.ToString("yyyy-MM-dd")');
                $('#userFilter').val('');
                $('#actionFilter').val('');
            });

            // Export logs
            $('#exportLogs').click(function () {
                alert('Đang xuất nhật ký... (Tính năng sẽ được triển khai sau)');
            });

            // View log details
            $('.logs-table tbody tr').click(function () {
                var row = $(this);
                $('#detailTimestamp').text(row.find('td:eq(0)').text());
                $('#detailUser').text(row.find('td:eq(1)').text());
                $('#detailRole').text(row.find('td:eq(2)').text());
                $('#detailAction').text(row.find('td:eq(3)').text());
                $('#detailDescription').text(row.find('td:eq(4)').text());
                $('#detailIP').text(row.find('td:eq(5)').text());
                $('#detailStatus').text(row.find('td:eq(6)').text());

                $('#logDetailsModal').modal('show');
            });

            // Update total logs count
            function updateLogCount() {
                var totalLogs = $('#logsTable tbody tr').length;
                $('#totalLogs').text('Hiển thị ' + totalLogs + ' / ' + totalLogs + ' nhật ký');
            }

            updateLogCount();
        });
    </script>
}