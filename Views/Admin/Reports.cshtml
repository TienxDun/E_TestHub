@{
    ViewData["Title"] = "Báo Cáo Thống Kê - Quản Trị Viên";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

@section Styles {
    <link href="~/css/admin/reports.css" rel="stylesheet">
}

<div class="reports-container">
    <div class="reports-header">
        <h1 class="reports-title">Báo Cáo Thống Kê</h1>
        <p class="reports-subtitle">Xem tổng quan và báo cáo chi tiết về hệ thống</p>
    </div>

    <!-- Filters Section -->
    <div class="reports-filters">
        <div class="filter-group">
            <label for="reportType" class="filter-label">Loại Báo Cáo</label>
            <select id="reportType" class="filter-select">
                <option value="overview" selected>Tổng Quan</option>
                <option value="users">Người Dùng</option>
                <option value="exams">Kỳ Thi</option>
                <option value="performance">Hiệu Suất</option>
            </select>
        </div>

        <div class="filter-group">
            <label for="dateRange" class="filter-label">Khoảng Thời Gian</label>
            <select id="dateRange" class="filter-select">
                <option value="today">Hôm Nay</option>
                <option value="week" selected>Tuần Này</option>
                <option value="month">Tháng Này</option>
                <option value="quarter">Quý Này</option>
                <option value="year">Năm Nay</option>
                <option value="custom">Tùy Chỉnh</option>
            </select>
        </div>

        <div class="filter-group date-range-group" style="display: none;">
            <label class="filter-label">Từ Ngày</label>
            <input type="date" id="startDate" class="filter-input" />
        </div>

        <div class="filter-group date-range-group" style="display: none;">
            <label class="filter-label">Đến Ngày</label>
            <input type="date" id="endDate" class="filter-input" />
        </div>

        <div class="filter-actions">
            <button id="generateReport" class="btn btn-primary">
                <i class="fas fa-chart-bar"></i> Tạo Báo Cáo
            </button>
            <button id="exportReport" class="btn btn-secondary">
                <i class="fas fa-download"></i> Xuất Báo Cáo
            </button>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="stats-cards">
        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-users"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">@ViewBag.TotalUsers</h3>
                <p class="stat-label">Tổng Người Dùng</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-user-check"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">@ViewBag.ActiveUsers</h3>
                <p class="stat-label">Người Dùng Hoạt Động</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-graduation-cap"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">@ViewBag.StudentsCount</h3>
                <p class="stat-label">Sinh Viên</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-chalkboard-teacher"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">@ViewBag.TeachersCount</h3>
                <p class="stat-label">Giáo Viên</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-file-alt"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">@(ViewBag.SystemStats?.TotalExams ?? 0)</h3>
                <p class="stat-label">Tổng Kỳ Thi</p>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon">
                <i class="fas fa-check-circle"></i>
            </div>
            <div class="stat-content">
                <h3 class="stat-number">@(ViewBag.SystemStats?.CompletedExams ?? 0)</h3>
                <p class="stat-label">Kỳ Thi Hoàn Thành</p>
            </div>
        </div>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
        <div class="chart-container">
            <h3 class="chart-title">Thống Kê Người Dùng Theo Vai Trò</h3>
            <canvas id="userRoleChart" width="400" height="200"></canvas>
        </div>

        <div class="chart-container">
            <h3 class="chart-title">Hoạt Động Kỳ Thi Theo Thời Gian</h3>
            <canvas id="examActivityChart" width="400" height="200"></canvas>
        </div>
    </div>

    <!-- Detailed Reports Table -->
    <div class="reports-table-container">
        <h3 class="table-title">Chi Tiết Báo Cáo</h3>
        <div class="table-responsive">
            <table class="reports-table" id="reportsTable">
                <thead>
                    <tr>
                        <th>Ngày</th>
                        <th>Người Dùng Mới</th>
                        <th>Kỳ Thi Tạo</th>
                        <th>Kỳ Thi Hoàn Thành</th>
                        <th>Điểm Trung Bình</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Sample data - will be populated by JavaScript -->
                    <tr>
                        <td>@DateTime.Now.ToString("dd/MM/yyyy")</td>
                        <td>5</td>
                        <td>2</td>
                        <td>15</td>
                        <td>7.8</td>
                    </tr>
                    <tr>
                        <td>@DateTime.Now.AddDays(-1).ToString("dd/MM/yyyy")</td>
                        <td>3</td>
                        <td>1</td>
                        <td>12</td>
                        <td>8.2</td>
                    </tr>
                    <tr>
                        <td>@DateTime.Now.AddDays(-2).ToString("dd/MM/yyyy")</td>
                        <td>7</td>
                        <td>3</td>
                        <td>18</td>
                        <td>7.5</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        $(document).ready(function () {
            // Toggle custom date range
            $('#dateRange').change(function () {
                if ($(this).val() === 'custom') {
                    $('.date-range-group').show();
                } else {
                    $('.date-range-group').hide();
                }
            });

            // Generate report button
            $('#generateReport').click(function () {
                // In a real implementation, this would make an AJAX call to get filtered data
                alert('Đang tạo báo cáo... (Tính năng này sẽ được triển khai sau)');
            });

            // Export report button
            $('#exportReport').click(function () {
                // In a real implementation, this would export the current report
                alert('Đang xuất báo cáo... (Tính năng này sẽ được triển khai sau)');
            });

            // User Role Chart
            var userRoleCtx = document.getElementById('userRoleChart').getContext('2d');
            var userRoleChart = new Chart(userRoleCtx, {
                type: 'doughnut',
                data: {
                    labels: ['Sinh Viên', 'Giáo Viên', 'Quản Trị Viên'],
                    datasets: [{
                        data: [@ViewBag.StudentsCount, @ViewBag.TeachersCount, @ViewBag.AdminsCount],
                        backgroundColor: [
                            '#2E8BE9',
                            '#10B981',
                            '#F59E0B'
                        ],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });

            // Exam Activity Chart
            var examActivityCtx = document.getElementById('examActivityChart').getContext('2d');
            var examActivityChart = new Chart(examActivityCtx, {
                type: 'line',
                data: {
                    labels: ['Tuần 1', 'Tuần 2', 'Tuần 3', 'Tuần 4'],
                    datasets: [{
                        label: 'Kỳ Thi Tạo',
                        data: [12, 19, 15, 25],
                        borderColor: '#2E8BE9',
                        backgroundColor: 'rgba(46, 139, 233, 0.1)',
                        tension: 0.4
                    }, {
                        label: 'Kỳ Thi Hoàn Thành',
                        data: [8, 15, 12, 20],
                        borderColor: '#10B981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
        });
    </script>
}